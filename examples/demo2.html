<!DOCTYPE html>
<html lang="en">
<head>
	<title>three.js webgl - lightning strike</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<link type="text/css" rel="stylesheet" href="main.css">
</head>
<body>

<div id="container"></div>
<div id="info"><a href="https://threejs.org" target="_blank" rel="noopener">three.js</a> webgl - lightning strike</div>

<!-- Import maps polyfill -->
<!-- Remove this when import maps will be widely supported -->
<script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>

<script type="importmap">
			{
				"imports": {
					"three": "../build/three.module.js"
				}
			}



</script>
<script type="module">

	import * as THREE from 'three';
	import Stats from './jsm/libs/stats.module.js';
	import {GUI} from './jsm/libs/lil-gui.module.min.js';
	import {OrbitControls} from './jsm/controls/OrbitControls.js';
	import {GLTFLoader} from './jsm/loaders/GLTFLoader.js';
	import {DRACOLoader} from './jsm/loaders/DRACOLoader.js';
	import {RGBELoader} from './jsm/loaders/RGBELoader.js';

	let container, stats;
	let scene, camera, renderer, controls, gui, params;
	let currentSceneIndex = 0;
	const sceneCreators = [
		createConesScene,
		createPlasmaBallScene
	];
	const clock = new THREE.Clock();
	const mouse = new THREE.Vector2();
	init();
	animate();

	function init() {
		container = document.getElementById('container');
		renderer = new THREE.WebGLRenderer();
		renderer.setPixelRatio(window.devicePixelRatio);
		renderer.setSize(window.innerWidth, window.innerHeight);
		params = {
			sceneIndex: 0
		}
		renderer.outputEncoding = THREE.sRGBEncoding;
		container.appendChild(renderer.domElement);
		stats = new Stats();
		container.appendChild(stats.dom);
		window.addEventListener('resize', onWindowResize);
		createScene();
	}

	function createScene() {
		params = sceneCreators[currentSceneIndex]();
		createGUI();
	}

	function onWindowResize() {
		camera.aspect = window.innerWidth / window.innerHeight;
		camera.updateProjectionMatrix();
		renderer.setSize(window.innerWidth, window.innerHeight);
	}

	//
	function createGUI() {
		if (gui) {
			gui.destroy();
		}
		gui = new GUI({width: 315});
		const sceneFolder = gui.addFolder('Scene');
		params.sceneIndex = currentSceneIndex;
		sceneFolder.add(params, 'sceneIndex', {
			'外部': 0,
			'内饰': 1,
		}).name('Scene').onChange(function (value) {
			currentSceneIndex = value;
			params.sceneIndex = value;
			createScene();
		});
	}

	function animate() {
		requestAnimationFrame(animate);
		render();
	}

	function render() {
		renderer.render(scene, camera);
		// stats.update();
	}

	//
	function createConesScene() {
		camera = new THREE.PerspectiveCamera(27, window.innerWidth / window.innerHeight, 200, 100000);
		camera.position.set(4.25, 1.4, -4.5);

		// controls = new OrbitControls(camera, container);
		// controls.enableDamping = true;
		// controls.maxDistance = 9;
		// controls.target.set(0, 0.5, 0);
		// controls.update();
		//
		// scene = new THREE.Scene();
		// scene.background = new THREE.Color(0x333333);
		// scene.environment = new RGBELoader().load('textures/equirectangular/venice_sunset_1k.hdr');
		// scene.environment.mapping = THREE.EquirectangularReflectionMapping;
		// scene.fog = new THREE.Fog(0x333333, 10, 15);
		// // Car
		// const shadow = new THREE.TextureLoader().load('models/gltf/ferrari_ao.png');
		// const dracoLoader = new DRACOLoader();
		// dracoLoader.setDecoderPath('js/libs/draco/gltf/');
		// const loader = new GLTFLoader();
		// loader.setDRACOLoader(dracoLoader);
		// loader.load('models/gltf/ferrari.glb', function (gltf) {
		// 	const carModel = gltf.scene.children[0];
		// 	// shadow
		// 	const mesh = new THREE.Mesh(
		// 			new THREE.PlaneGeometry(0.655 * 4, 1.3 * 4),
		// 			new THREE.MeshBasicMaterial({
		// 				map: shadow, blending: THREE.MultiplyBlending, toneMapped: false, transparent: true
		// 			})
		// 	);
		// 	mesh.rotation.x = -Math.PI / 2;
		// 	mesh.renderOrder = 2;
		// 	carModel.add(mesh);
		// 	scene.add(carModel);
		// });
	}

	//
	function createPlasmaBallScene() {
		const scene = new THREE.Scene();
		camera = new THREE.PerspectiveCamera(27, window.innerWidth / window.innerHeight, 100, 50000);
		const ballScene = new THREE.Scene();
		ballScene.background = new THREE.Color(0x454545);
		// Lights
		const ambientLight = new THREE.AmbientLight(0x444444);
		ballScene.add(ambientLight);
		scene.add(ambientLight);

		const light1 = new THREE.DirectionalLight(0xffffff, 0.5);
		light1.position.set(1, 1, 1);
		ballScene.add(light1);
		scene.add(light1);

		return scene;
	}
</script>
</body>
</html>
